<extend name="Public/base"/>

<block name="body">
    <div class="tw-layout">
        <div class="tw-list-hd"> {:isset($info['id'])?'编辑':'新增'}皮肤 </div>
        <div class="tw-list-wrap tw-edit-wrap">
            <form action="__SELF__" method="post" class="form-horizontal ajaxForm">
                <div class="form-item">
                    <label class="item-label">皮肤名称<span class="check-tips"><b>*</b>（输入皮肤名称）</span></label>
                    <div class="controls">
                        <input type="text" class="text input-large" name="name" value="{$info.name}">
                    </div>
                </div>
                <div class="form-item">
                    <label class="item-label">可使用商家<span class="check-tips"><b>*</b>（选择可使用商家）</span></label>
                    <div class="controls"> 
                        <input type="hidden" id="operate_person_id" name="member_ids" value="{$info.member_ids}">
                        <textarea rows="5" cols="57" onclick="selectUser('operate_person', '{$info.member_ids}')" readonly id="operate_person_name">{$operatePerson}</textarea><br/>
                    </div>
                </div>
                <div class="form-item">
                    <label class="item-label">排序<span class="check-tips"></label>
                    <div class="controls">
                        <input type="text" class="text input-large" name="sort" value="{$info.sort}">
                    </div>
                </div>
                <div class="form-item">
                    <label class="item-label">上传皮肤图标<span class="check-tips"><b>*</b>（用于上传皮肤图标 请上传大于400*400的正方形图片）</span></label>
                    <div class="controls">
                        <div>
                            <img src="{$info.photo_path}" style="height:129px; width:129px;" id="img_"/>
                        </div>
                        <input type="hidden" value="{$info.photo_path}" name="photo_path" id="img" />
                            <input class="btn btn-default btn-xs" type="button" value="上传" id="btnUpload"/>
                            <input class="btn btn-danger btn-xs" type="button" value="删除" onclick="delImg($('#img').val(), '')" id="btn_delete_" />
                            <if condition="$info.photo_path eq ''">
                                <script>
                                    $("#img_, #btn_delete_").hide();
                                </script>
                            </if>
                    </div>
                </div>
                <div class="form-item">
                    <label class="item-label">上传附件<span class="check-tips"><b>*</b>（附件格式：ZIP）</span></label>
                    <div class="controls">
                        <div>
                            <div style="height:20px; width:100px;" id="img_file_">已经上传</div>
                        </div>
                        <input type="hidden" value="{$info.file_path}" name="file_path" id="enclosure" />
                        <input class="btn btn-default btn-xs" type="button" value="上传" id="btnFileUpload"/>
                        <input class="btn btn-danger btn-xs" type="button" value="删除" onclick="delFileField($('#enclosure').val(), '')" id="btn_file_delete_" />
                        <if condition="$info.file_path eq ''">
                            <script>
                                $("#img_file_, #btn_file_delete_").hide();
                            </script>
                        </if>
                    </div>
                </div>
                <div class="form-item">
                    <label class="item-label">是否启用<span class="check-tips"><b>*</b></span></label>
                    <label class="wf-form-label-rc">
                        <input type="radio" value="0" name="disabled" id="isTure" checked="checked"> 是
                    </label>
                    <label class="wf-form-label-rc">
                        <input type="radio" value="1" name="disabled" id="isFalse"> 否
                    </label>
                    <if condition="$info['attr_require'] eq 1">
                        <script>
                            $('#isFalse').attr('checked', 'checked');
                        </script>
                    </if>
                </div>
                
                <div class="tw-tool-bar-bot">
                    <button type="submit" class="tw-act-btn-confirm">提交</button>
                    <button type="button" onclick="goback()" class="tw-act-btn-cancel">返回</button>
                </div>
                <input type="hidden" name="id" value="{$info.id|default=''}"/>
            </form>
        </div>
    </div>
</block>

<block name="script">
    <script type="text/javascript" charset="utf-8" src="__PUBLIC__/ajaxupload.js"></script>
    <script type="text/javascript" charset="utf-8" src="__COMMON__/js/imgupload.js"></script>
    <script type="text/javascript" charset="utf-8" src="__JS__/admin.js"></script>
    <script type="text/javascript" charset="utf-8" src="__JS__/skin/skin.js"></script>
    <script>
        $(function(){
            ajaxUpload('#btnUpload', $("#img"), 'skinImg', '');
            ajaxSkinUploadField('#btnFileUpload', $("#enclosure"), 'skin', '');
        })
        
        // 调出选择商户的界面
        function selectUser(type, ids){
            layer.open({
            	type: 2,
            	title: '选择可操作的商家',
            	shadeClose: true,
            	shade: 0.8,
            	area: ['800px', '500px'],
            	content:"{:U('ajaxGetMember/selectPerson', '', '')}/type/"+type+"/ids/"+ids
            });
        }
        // 父页面接受子页面传过来的数据
        function addOperatePerson(show_member, show_id){
            if (show_member[0]) {
                var show_member_string = show_member.join(",")+',';
            }else{
                var show_member_string = '';
            };  
            $("#operate_person_id").val("");
            $("#operate_person_name").html("");
            $("#operate_person_id").val(show_id);
            $("#operate_person_name").append(show_member_string);
        }
    </script>
</block>