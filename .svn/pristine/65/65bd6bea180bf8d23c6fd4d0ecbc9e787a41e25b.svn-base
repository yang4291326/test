<?php
namespace Admin\Model;
use Think\Model;

/**
 * 用户机器码模型
 * @author yuanyulin <QQ:755687023>
 */
class MemberMachineCodeModel extends Model{
    
    protected $_validate = array(
        array('member_id', 'number', '非法数据, 必须是数字！', self::MUST_VALIDATE, 'function', 3),
        
        array('machine_code', '4,20', '机器码不正确, 请输入4到20位字符！', self::MUST_VALIDATE, 'length', 3),
    );

    
    /**
     * 判断用户的新的机器二维码是否保存成功
     * @param array    $data  需要修改的二维码信息
     * @param int      $id    对应用户的member表中的id
     */
    public function editMemberMachineCode($data, $id=0) {
       
        $this->where('member_id='. $id)->delete(); // 删除原来的信息
        
        foreach ($data as $key => $value) { // 将新的信息写入表中
            $data['member_id'] = $id;
            $data['machine_code'] = $value['machine_code'];
            
            if($this->create($data) !== false){
                $this->add();
            } else {
                return($this->getError());
            }   
        }
        return 1;
    }   
}
